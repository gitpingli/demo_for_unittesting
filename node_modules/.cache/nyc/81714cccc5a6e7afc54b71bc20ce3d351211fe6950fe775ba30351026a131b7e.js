'use strict';var cov_ir9u4592z=function(){var path="/home/htchen/console-core-service-sherpa/app/service/heartbeat.js";var hash="b8468e3a42f30f0dfb62f1802e7603f33f521552";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/home/htchen/console-core-service-sherpa/app/service/heartbeat.js",statementMap:{"0":{start:{line:3,column:20},end:{line:3,column:34}},"1":{start:{line:7,column:20},end:{line:7,column:24}},"2":{start:{line:9,column:23},end:{line:9,column:27}},"3":{start:{line:10,column:4},end:{line:12,column:5}},"4":{start:{line:11,column:6},end:{line:11,column:72}},"5":{start:{line:13,column:16},end:{line:13,column:58}},"6":{start:{line:14,column:4},end:{line:14,column:35}},"7":{start:{line:15,column:19},end:{line:17,column:6}},"8":{start:{line:18,column:4},end:{line:26,column:5}},"9":{start:{line:24,column:10},end:{line:24,column:21}},"10":{start:{line:25,column:6},end:{line:25,column:52}},"11":{start:{line:28,column:4},end:{line:33,column:6}},"12":{start:{line:37,column:28},end:{line:37,column:32}},"13":{start:{line:39,column:4},end:{line:47,column:6}},"14":{start:{line:51,column:0},end:{line:51,column:34}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:6,column:2},end:{line:6,column:3}},loc:{start:{line:6,column:21},end:{line:34,column:3}},line:6},"1":{name:"(anonymous_1)",decl:{start:{line:36,column:2},end:{line:36,column:3}},loc:{start:{line:36,column:18},end:{line:48,column:3}},line:36}},branchMap:{"0":{loc:{start:{line:10,column:4},end:{line:12,column:5}},type:"if",locations:[{start:{line:10,column:4},end:{line:12,column:5}},{start:{line:10,column:4},end:{line:12,column:5}}],line:10},"1":{loc:{start:{line:18,column:4},end:{line:26,column:5}},type:"if",locations:[{start:{line:18,column:4},end:{line:26,column:5}},{start:{line:18,column:4},end:{line:26,column:5}}],line:18},"2":{loc:{start:{line:20,column:8},end:{line:20,column:22}},type:"default-arg",locations:[{start:{line:20,column:15},end:{line:20,column:22}}],line:20},"3":{loc:{start:{line:21,column:8},end:{line:21,column:23}},type:"default-arg",locations:[{start:{line:21,column:18},end:{line:21,column:23}}],line:21},"4":{loc:{start:{line:22,column:8},end:{line:22,column:24}},type:"default-arg",locations:[{start:{line:22,column:22},end:{line:22,column:24}}],line:22},"5":{loc:{start:{line:23,column:8},end:{line:23,column:21}},type:"default-arg",locations:[{start:{line:23,column:17},end:{line:23,column:21}}],line:23}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0},f:{"0":0,"1":0},b:{"0":[0,0],"1":[0,0],"2":[0],"3":[0],"4":[0],"5":[0]},_coverageSchema:"43e27e138ebf9cfc5966b082cf9a028302ed4184",hash:"b8468e3a42f30f0dfb62f1802e7603f33f521552"};var coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}return coverage[path]=coverageData;}();const{Service}=(cov_ir9u4592z.s[0]++,require('egg'));class HeartbeatService extends Service{async get(service){cov_ir9u4592z.f[0]++;const{ctx}=(cov_ir9u4592z.s[1]++,this);// const status = { status: 'enabled' }
const{config}=(cov_ir9u4592z.s[2]++,this);cov_ir9u4592z.s[3]++;if(!config.service[service]){cov_ir9u4592z.b[0][0]++;cov_ir9u4592z.s[4]++;return ctx.throw(404,'Given service '+service+' is invalid');}else{cov_ir9u4592z.b[0][1]++;}const url=(cov_ir9u4592z.s[5]++,`${config.service[service].url}/heartbeat`);cov_ir9u4592z.s[6]++;ctx.logger.info('url:%s',url);const result=(cov_ir9u4592z.s[7]++,await this.ctx.curl(url,{dataType:'json'}));cov_ir9u4592z.s[8]++;if(result.status===200){cov_ir9u4592z.b[1][0]++;const{name=(cov_ir9u4592z.b[2][0]++,service),version=(cov_ir9u4592z.b[3][0]++,'N/A'),description=(cov_ir9u4592z.b[4][0]++,''),status=(cov_ir9u4592z.b[5][0]++,'UP')}=(cov_ir9u4592z.s[9]++,result.data);cov_ir9u4592z.s[10]++;return{name,version,description,status};}else{cov_ir9u4592z.b[1][1]++;}cov_ir9u4592z.s[11]++;return{name:service,version:'UNKNOW',description:result.data,status:'DOWN'};}async getInfo(){cov_ir9u4592z.f[1]++;const{ctx,config}=(cov_ir9u4592z.s[12]++,this);cov_ir9u4592z.s[13]++;return{name:config.name,version:config.pkg.version,description:config.pkg.description,status:'UP',current:new Date().toJSON(),startUpAt:ctx.helper.getStartUpAt(),releasedAt:require('fs').readFileSync('./release.txt','utf8')};}}cov_ir9u4592z.s[14]++;module.exports=HeartbeatService;