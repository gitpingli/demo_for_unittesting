'use strict';var cov_18q4wco1iq=function(){var path="/home/pingli/workspace/repository/pccw/demo/sherpa-api/console-core-service-sherpa/app/service/ums/ums.js";var hash="c9d70e8026537d18564776a2a46ef654d31f5a18";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/home/pingli/workspace/repository/pccw/demo/sherpa-api/console-core-service-sherpa/app/service/ums/ums.js",statementMap:{"0":{start:{line:3,column:20},end:{line:3,column:34}},"1":{start:{line:7,column:20},end:{line:7,column:24}},"2":{start:{line:8,column:23},end:{line:8,column:27}},"3":{start:{line:10,column:89},end:{line:10,column:108}},"4":{start:{line:12,column:20},end:{line:12,column:39}},"5":{start:{line:13,column:20},end:{line:13,column:22}},"6":{start:{line:14,column:18},end:{line:14,column:45}},"7":{start:{line:15,column:4},end:{line:17,column:5}},"8":{start:{line:16,column:6},end:{line:16,column:86}},"9":{start:{line:19,column:16},end:{line:26,column:5}},"10":{start:{line:28,column:4},end:{line:28,column:45}},"11":{start:{line:32,column:19},end:{line:34,column:77}},"12":{start:{line:38,column:4},end:{line:40,column:5}},"13":{start:{line:39,column:6},end:{line:39,column:24}},"14":{start:{line:42,column:4},end:{line:42,column:40}},"15":{start:{line:44,column:4},end:{line:44,column:41}},"16":{start:{line:48,column:0},end:{line:48,column:27}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:6,column:2},end:{line:6,column:3}},loc:{start:{line:6,column:53},end:{line:45,column:3}},line:6}},branchMap:{"0":{loc:{start:{line:6,column:26},end:{line:6,column:40}},type:"default-arg",locations:[{start:{line:6,column:35},end:{line:6,column:40}}],line:6},"1":{loc:{start:{line:10,column:26},end:{line:10,column:40}},type:"default-arg",locations:[{start:{line:10,column:36},end:{line:10,column:40}}],line:10},"2":{loc:{start:{line:15,column:4},end:{line:17,column:5}},type:"if",locations:[{start:{line:15,column:4},end:{line:17,column:5}},{start:{line:15,column:4},end:{line:17,column:5}}],line:15},"3":{loc:{start:{line:16,column:27},end:{line:16,column:86}},type:"cond-expr",locations:[{start:{line:16,column:48},end:{line:16,column:78}},{start:{line:16,column:81},end:{line:16,column:86}}],line:16},"4":{loc:{start:{line:32,column:19},end:{line:34,column:77}},type:"cond-expr",locations:[{start:{line:33,column:8},end:{line:33,column:36}},{start:{line:34,column:8},end:{line:34,column:77}}],line:32},"5":{loc:{start:{line:38,column:4},end:{line:40,column:5}},type:"if",locations:[{start:{line:38,column:4},end:{line:40,column:5}},{start:{line:38,column:4},end:{line:40,column:5}}],line:38},"6":{loc:{start:{line:38,column:8},end:{line:38,column:54}},type:"binary-expr",locations:[{start:{line:38,column:8},end:{line:38,column:29}},{start:{line:38,column:33},end:{line:38,column:54}}],line:38}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0},f:{"0":0},b:{"0":[0],"1":[0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0]},_coverageSchema:"43e27e138ebf9cfc5966b082cf9a028302ed4184",hash:"c9d70e8026537d18564776a2a46ef654d31f5a18"};var coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}return coverage[path]=coverageData;}();const{Service}=(cov_18q4wco1iq.s[0]++,require('egg'));class UmsService extends Service{async curl({endpoint,method=(cov_18q4wco1iq.b[0][0]++,'GET'),payload}){cov_18q4wco1iq.f[0]++;const{ctx}=(cov_18q4wco1iq.s[1]++,this);const{config}=(cov_18q4wco1iq.s[2]++,this);const{url,enabled,timeout=(cov_18q4wco1iq.b[1][0]++,5000),tokenName,tokenBearer,tokenBearerEnabled}=(cov_18q4wco1iq.s[3]++,config.service.user);const baseUrl=(cov_18q4wco1iq.s[4]++,`${url}${endpoint}`);const headers=(cov_18q4wco1iq.s[5]++,{});const token=(cov_18q4wco1iq.s[6]++,ctx.helper.getAccessToken());cov_18q4wco1iq.s[7]++;if(token){cov_18q4wco1iq.b[2][0]++;cov_18q4wco1iq.s[8]++;headers[tokenName]=tokenBearerEnabled?(cov_18q4wco1iq.b[3][0]++,tokenBearer.concat(' ',token)):(cov_18q4wco1iq.b[3][1]++,token);}else{cov_18q4wco1iq.b[2][1]++;}const req=(cov_18q4wco1iq.s[9]++,{method,contentType:'json',dataType:'json',data:payload,headers,timeout});cov_18q4wco1iq.s[10]++;ctx.logger.info('%s %s',method,baseUrl);// ctx.logger.info('payload:%j', req);
const result=(cov_18q4wco1iq.s[11]++,enabled?(cov_18q4wco1iq.b[4][0]++,await ctx.curl(baseUrl,req)):(cov_18q4wco1iq.b[4][1]++,await require('../../../mockData/userManagement').curl(endpoint,req)));// ctx.logger.info('result:%j', result);
cov_18q4wco1iq.s[12]++;if((cov_18q4wco1iq.b[6][0]++,result.status===200)||(cov_18q4wco1iq.b[6][1]++,result.status===201)){cov_18q4wco1iq.b[5][0]++;cov_18q4wco1iq.s[13]++;return result.data;}else{cov_18q4wco1iq.b[5][1]++;}cov_18q4wco1iq.s[14]++;ctx.logger.info('result:%j',result);cov_18q4wco1iq.s[15]++;ctx.throw(result.status,result.data);}}cov_18q4wco1iq.s[16]++;module.exports=UmsService;