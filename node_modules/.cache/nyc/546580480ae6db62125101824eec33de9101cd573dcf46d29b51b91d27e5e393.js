'use strict';var cov_2gfidyoon=function(){var path="/home/pingli/workspace/repository/pccw/demo/sherpa-api/console-core-service-sherpa/app/service/ums/member.js";var hash="6a2a010ecd205e0230af68cfac3a47bf47dcf4ea";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/home/pingli/workspace/repository/pccw/demo/sherpa-api/console-core-service-sherpa/app/service/ums/member.js",statementMap:{"0":{start:{line:3,column:19},end:{line:3,column:35}},"1":{start:{line:4,column:10},end:{line:4,column:27}},"2":{start:{line:8,column:18},end:{line:8,column:66}},"3":{start:{line:9,column:26},end:{line:9,column:116}},"4":{start:{line:10,column:16},end:{line:17,column:5}},"5":{start:{line:18,column:4},end:{line:28,column:5}},"6":{start:{line:19,column:22},end:{line:19,column:37}},"7":{start:{line:20,column:6},end:{line:27,column:7}},"8":{start:{line:29,column:17},end:{line:33,column:6}},"9":{start:{line:35,column:4},end:{line:35,column:34}},"10":{start:{line:39,column:20},end:{line:39,column:24}},"11":{start:{line:40,column:4},end:{line:40,column:46}},"12":{start:{line:41,column:17},end:{line:44,column:6}},"13":{start:{line:46,column:4},end:{line:46,column:34}},"14":{start:{line:50,column:18},end:{line:53,column:6}},"15":{start:{line:55,column:4},end:{line:55,column:56}},"16":{start:{line:55,column:32},end:{line:55,column:55}},"17":{start:{line:59,column:17},end:{line:63,column:6}},"18":{start:{line:65,column:4},end:{line:65,column:34}},"19":{start:{line:69,column:17},end:{line:72,column:6}},"20":{start:{line:74,column:4},end:{line:74,column:34}},"21":{start:{line:78,column:4},end:{line:107,column:5}},"22":{start:{line:111,column:0},end:{line:111,column:30}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:7,column:2},end:{line:7,column:3}},loc:{start:{line:7,column:36},end:{line:36,column:3}},line:7},"1":{name:"(anonymous_1)",decl:{start:{line:38,column:2},end:{line:38,column:3}},loc:{start:{line:38,column:36},end:{line:47,column:3}},line:38},"2":{name:"(anonymous_2)",decl:{start:{line:49,column:2},end:{line:49,column:3}},loc:{start:{line:49,column:25},end:{line:56,column:3}},line:49},"3":{name:"(anonymous_3)",decl:{start:{line:55,column:24},end:{line:55,column:25}},loc:{start:{line:55,column:32},end:{line:55,column:55}},line:55},"4":{name:"(anonymous_4)",decl:{start:{line:58,column:2},end:{line:58,column:3}},loc:{start:{line:58,column:40},end:{line:66,column:3}},line:58},"5":{name:"(anonymous_5)",decl:{start:{line:68,column:2},end:{line:68,column:3}},loc:{start:{line:68,column:32},end:{line:75,column:3}},line:68},"6":{name:"(anonymous_6)",decl:{start:{line:77,column:2},end:{line:77,column:3}},loc:{start:{line:77,column:22},end:{line:108,column:3}},line:77}},branchMap:{"0":{loc:{start:{line:8,column:18},end:{line:8,column:66}},type:"cond-expr",locations:[{start:{line:8,column:34},end:{line:8,column:47}},{start:{line:8,column:50},end:{line:8,column:66}}],line:8},"1":{loc:{start:{line:18,column:4},end:{line:28,column:5}},type:"if",locations:[{start:{line:18,column:4},end:{line:28,column:5}},{start:{line:18,column:4},end:{line:28,column:5}}],line:18},"2":{loc:{start:{line:97,column:15},end:{line:106,column:19}},type:"cond-expr",locations:[{start:{line:98,column:10},end:{line:105,column:9}},{start:{line:106,column:10},end:{line:106,column:19}}],line:97}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0},b:{"0":[0,0],"1":[0,0],"2":[0,0]},_coverageSchema:"43e27e138ebf9cfc5966b082cf9a028302ed4184",hash:"6a2a010ecd205e0230af68cfac3a47bf47dcf4ea"};var coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}return coverage[path]=coverageData;}();const UmsService=(cov_2gfidyoon.s[0]++,require('./ums'));const _=(cov_2gfidyoon.s[1]++,require('lodash'));class MemberService extends UmsService{async create(companyId,payload){cov_2gfidyoon.f[0]++;const roles=(cov_2gfidyoon.s[2]++,payload.roles?(cov_2gfidyoon.b[0][0]++,payload.roles):(cov_2gfidyoon.b[0][1]++,['PARTNER_USER']));const isPartnerUser=(cov_2gfidyoon.s[3]++,_.intersection(roles,['PARTNER_SUPER_ADMIN','PARTNER_ADMIN','PARTNER_USER']).length>0);const req=(cov_2gfidyoon.s[4]++,{firstname:payload.first,lastname:payload.last,email:payload.email,roles,isPartnerUser,companyId});cov_2gfidyoon.s[5]++;if(payload.address){cov_2gfidyoon.b[1][0]++;const address=(cov_2gfidyoon.s[6]++,payload.address);cov_2gfidyoon.s[7]++;req.address={telephone:address.telephone,street:address.address,city:address.city,state:address.state,country:address.country,zip:address.zip};}else{cov_2gfidyoon.b[1][1]++;}const user=(cov_2gfidyoon.s[8]++,await this.curl({method:'POST',endpoint:'/users/signup',payload:req}));cov_2gfidyoon.s[9]++;return this.renderMember(user);}async findOne(companyId,userId){cov_2gfidyoon.f[1]++;const{ctx}=(cov_2gfidyoon.s[10]++,this);cov_2gfidyoon.s[11]++;ctx.logger.info('find user by %s',userId);const user=(cov_2gfidyoon.s[12]++,await this.curl({method:'GET',endpoint:`/users/${userId}`}));cov_2gfidyoon.s[13]++;return this.renderMember(user);}async list(companyId){cov_2gfidyoon.f[2]++;const users=(cov_2gfidyoon.s[14]++,await this.curl({method:'GET',endpoint:`/users?companyId=${companyId}`}));cov_2gfidyoon.s[15]++;return _.map(users,user=>{cov_2gfidyoon.f[3]++;cov_2gfidyoon.s[16]++;return this.renderMember(user);});}async update(companyId,id,payload){cov_2gfidyoon.f[4]++;const user=(cov_2gfidyoon.s[17]++,await this.curl({method:'PATCH',endpoint:`/users/${id}`,payload}));cov_2gfidyoon.s[18]++;return this.renderMember(user);}async destroy(companyId,id){cov_2gfidyoon.f[5]++;const user=(cov_2gfidyoon.s[19]++,await this.curl({method:'DELETE',endpoint:`/users/${id}`}));cov_2gfidyoon.s[20]++;return this.renderMember(user);}renderMember(user){cov_2gfidyoon.f[6]++;cov_2gfidyoon.s[21]++;return{id:user.id,deleted:user.deleted,createdBy:user.createdBy,updatedBy:user.updatedBy,deletedBy:user.deletedBy,createdAt:user.createdAt,updatedAt:user.updatedAt,deletedAt:user.deletedAt,email:user.email,roles:user.roles,companyId:user.company,state:user.state,type:user.type,lastLogonDate:user.lastLogonDate,first:user.firstname,last:user.lastname,avatar:'https://gw.alipayobjects.com/zos/antfincdn/XAosXuNZyF/BiazfanxmamNRoxxVxka.png',address:user.address?(cov_2gfidyoon.b[2][0]++,{telephone:user.address.telephone,address:user.address.street,city:user.address.city,state:user.address.state,country:user.address.country,zip:user.address.zip}):(cov_2gfidyoon.b[2][1]++,undefined)};}}cov_2gfidyoon.s[22]++;module.exports=MemberService;